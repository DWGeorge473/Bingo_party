<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Baby Shower Bingo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root{
      --mint:#b7d8cc;
      --mint-2:#9fcbbd;
      --mint-3:#dff1ea;
      --paper:#ffffff;
      --ink:#2b2b2b;

      --grid:#97c8b8;
      --shadow: 0 18px 40px rgba(26, 55, 45, 0.12);

      --radius-lg: 18px;
      --radius-md: 14px;
    }

    *{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      color: var(--ink);
      min-height: 100vh;
      display:flex;
      justify-content:center;
      padding: 18px 14px 26px;
      background:
        radial-gradient(circle at top, #f6fbff 0, #eefbf6 35%, #f8fffc 100%);
    }

    .app{
      width:100%;
      max-width: 980px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    /* Decorative top trim */
    .trim{
      height: 22px;
      border-radius: 14px;
      background:
        repeating-linear-gradient(
          135deg,
          rgba(183,216,204,0.95) 0 10px,
          rgba(230,248,241,0.95) 10px 20px
        );
      border: 2px solid rgba(151,200,184,0.9);
      position: relative;
      overflow:hidden;
      box-shadow: 0 10px 18px rgba(26,55,45,0.08);
    }
    .trim::after{
      content:"";
      position:absolute;
      inset:0;
      background:
        radial-gradient(circle at 12% 40%, rgba(245,148,185,0.55) 0 3px, transparent 4px),
        radial-gradient(circle at 28% 60%, rgba(126,217,255,0.6) 0 3px, transparent 4px),
        radial-gradient(circle at 44% 35%, rgba(255,193,118,0.55) 0 3px, transparent 4px),
        radial-gradient(circle at 60% 55%, rgba(186,145,255,0.55) 0 3px, transparent 4px),
        radial-gradient(circle at 76% 45%, rgba(169,230,162,0.6) 0 3px, transparent 4px),
        radial-gradient(circle at 90% 60%, rgba(255,193,118,0.55) 0 3px, transparent 4px);
      opacity: .9;
      pointer-events:none;
    }

    header{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:12px;
      flex-wrap:wrap;
    }

    .titleBlock{
      background: var(--paper);
      border: 3px solid var(--mint);
      border-radius: var(--radius-lg);
      padding: 14px 16px 12px;
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
      min-width: min(560px, 100%);
    }

    .titleBlock::before{
      content:"";
      position:absolute;
      inset:-40px;
      background:
        radial-gradient(circle at 15% 20%, rgba(126,217,255,0.18), transparent 55%),
        radial-gradient(circle at 90% 30%, rgba(245,148,185,0.16), transparent 55%),
        radial-gradient(circle at 50% 120%, rgba(169,230,162,0.15), transparent 55%);
      pointer-events:none;
    }

    .titleInner{ position:relative; z-index:1; }

    .babyShower{
      font-family: ui-rounded, "Segoe UI", system-ui, sans-serif;
      font-weight: 600;
      letter-spacing: .06em;
      font-size: clamp(1.35rem, 3vw, 2.1rem);
      color: #a78bd0;
      line-height: 1.05;
    }

    .bingoWord{
      font-weight: 900;
      letter-spacing: .22em;
      text-transform: uppercase;
      font-size: clamp(1.7rem, 3.6vw, 2.7rem);
      color: #a8c56e;
      margin-top: 4px;
    }

    .subtitle{
      margin-top: 6px;
      font-size: .92rem;
      color: rgba(43,43,43,0.72);
    }

    .mode-switch{
      display:inline-flex;
      gap:8px;
      background: var(--paper);
      border: 3px solid var(--mint);
      border-radius: 999px;
      padding: 6px;
      box-shadow: var(--shadow);
      align-items:center;
    }

    .mode-btn{
      border:none;
      background:transparent;
      cursor:pointer;
      padding: 10px 14px;
      border-radius: 999px;
      font-weight: 700;
      color: rgba(43,43,43,0.65);
      display:inline-flex;
      gap:8px;
      align-items:center;
      transition: transform .12s ease, background .12s ease;
      white-space:nowrap;
    }
    .mode-btn:active{ transform: scale(.98); }
    .mode-btn.active{
      background: rgba(183,216,204,0.35);
      color: rgba(43,43,43,0.92);
    }

    main{
      display:grid;
      grid-template-columns: minmax(0, 1.35fr) minmax(0, 1fr);
      gap: 14px;
      align-items:start;
    }
    @media (max-width: 860px){
      main{ grid-template-columns: minmax(0, 1fr); }
    }

    .card-shell{
      background: var(--paper);
      border: 3px solid var(--mint);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow);
      padding: 12px;
      position:relative;
      overflow:hidden;
    }

    .section-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom: 8px;
    }
    .section-header h2{
      margin:0;
      font-size:.95rem;
      letter-spacing:.14em;
      text-transform:uppercase;
      color: rgba(43,43,43,0.72);
    }

    .badge{
      border: 2px solid var(--mint);
      background: rgba(223,241,234,0.7);
      border-radius: 999px;
      padding: 6px 10px;
      font-size: .8rem;
      font-weight: 700;
      color: rgba(43,43,43,0.75);
      white-space: nowrap;
    }

    .bingo-grid{
      display:grid;
      grid-template-columns: repeat(5, minmax(0, 1fr));
      gap: 0;
      border: 3px solid var(--grid);
      border-radius: 12px;
      overflow:hidden;
      background: #fafffd;
    }

    .bingo-cell{
      border-right: 2px solid var(--grid);
      border-bottom: 2px solid var(--grid);
      background: #ffffff;

      /* RESPONSIVE sizing */
      min-height: clamp(52px, 12vw, 78px);
      padding: clamp(6px, 1.3vw, 10px);

      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;

      cursor:pointer;
      position:relative;
      transition: transform .12s ease, background .12s ease;
      user-select:none;
    }
    .bingo-cell:nth-child(5n){ border-right:none; }
    .bingo-cell:nth-last-child(-n + 5){ border-bottom:none; }

    .bingo-cell .value{
      font-weight: 900;
      line-height: 1.08;

      /* RESPONSIVE text sizing */
      font-size: clamp(0.60rem, 2.35vw, 1.02rem);

      word-break: break-word;
      overflow-wrap: anywhere;
      hyphens: auto;
    }

    .c1{ color:#f39c6b; }
    .c2{ color:#77b7d8; }
    .c3{ color:#a78bd0; }
    .c4{ color:#a8c56e; }
    .c5{ color:#f09ab6; }

    .bingo-cell.marked{
      background: rgba(223,241,234,0.95);
    }
    .bingo-cell.marked::after{
      content:"‚úì";
      position:absolute;
      top: 6px;
      right: 8px;
      font-weight: 900;
      color: rgba(67,160,127,0.9);
      font-size: 1.05rem;
    }

    .bingo-cell.free{
      background: radial-gradient(circle at 40% 35%, rgba(255,255,255,0.95), rgba(223,241,234,0.85));
      cursor: default;
    }

    .freeMark{
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap: 8px;
    }
    .freeDG{
      display:flex;
      align-items:center;
      gap: 8px;
      font-weight: 1000;
      letter-spacing:.14em;
      font-size: clamp(0.95rem, 3.2vw, 1.35rem);
      color: rgba(43,43,43,0.78);
      text-transform: uppercase;
      line-height: 1;
    }
    .pawAmp{
      width: clamp(18px, 4vw, 26px);
      height: clamp(18px, 4vw, 26px);
      display:inline-block;
    }
    .freeSmall{
      font-size: clamp(0.56rem, 1.9vw, 0.72rem);
      font-weight: 900;
      letter-spacing: .12em;
      text-transform: uppercase;
      color: rgba(43,43,43,0.55);
    }

    .bingo-cell.pulse{ animation: pulse .18s ease-out; }
    @keyframes pulse{
      from{ transform: scale(1); }
      50%{ transform: scale(1.035); }
      to{ transform: scale(1); }
    }

    .bottom-toolbar{
      margin-top: 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    .bottom-nav{
      display:inline-flex;
      align-items:center;
      gap:8px;
      border-radius: 999px;
      border: 3px solid var(--mint);
      background: var(--paper);
      padding: 6px 10px;
      box-shadow: var(--shadow);
    }

    .card-switch-btn{
      border:none;
      background: rgba(223,241,234,0.8);
      border: 2px solid var(--mint);
      width: 38px;
      height: 38px;
      border-radius: 999px;
      cursor:pointer;
      font-weight:900;
      color: rgba(43,43,43,0.8);
      opacity:.55;
    }

    .card-switch-label{
      font-size:.9rem;
      color: rgba(43,43,43,0.75);
      white-space:nowrap;
    }
    .card-switch-label strong{ color: rgba(43,43,43,0.92); }

    .menu-toggle-btn{
      border:none;
      cursor:pointer;
      width: 46px;
      height: 46px;
      border-radius: 999px;
      border: 3px solid var(--mint);
      background: var(--paper);
      box-shadow: var(--shadow);
      font-size: 1.35rem;
      color: rgba(43,43,43,0.9);

      /* keep above blur/backdrop */
      position: relative;
      z-index: 40;
    }

    .player-menu-backdrop{
      position:absolute;
      inset:0;
      background: rgba(0,0,0,0.08);
      backdrop-filter: blur(2px);
      z-index: 20;
    }

    .player-menu{
      position:absolute;
      left: 12px;
      right: 12px;
      bottom: 72px;
      background: var(--paper);
      border: 3px solid var(--mint);
      border-radius: 16px;
      padding: 12px;
      z-index: 30;
      box-shadow: var(--shadow);
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .player-menu-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }

    .player-menu-title{
      font-size:.85rem;
      text-transform:uppercase;
      letter-spacing:.14em;
      color: rgba(43,43,43,0.65);
      font-weight: 1000;
      margin:0;
    }

    .menu-close{
      border:none;
      background: rgba(223,241,234,0.92);
      border: 2px solid var(--mint);
      width: 38px;
      height: 38px;
      border-radius: 999px;
      cursor:pointer;
      font-size: 1.1rem;
      font-weight: 1000;
      color: rgba(43,43,43,0.85);
      flex: 0 0 auto;

      /* ensure it is ALWAYS crisp and above */
      position: relative;
      z-index: 45;
    }

    .btn{
      width: 100%;
      padding: 12px 14px;
      border-radius: 999px;
      border: 3px solid var(--mint);
      background: rgba(223,241,234,0.8);
      font-weight: 1000;
      cursor:pointer;
      color: rgba(43,43,43,0.85);
    }
    .btn.primary{
      background: linear-gradient(135deg, rgba(169,230,162,0.75), rgba(126,217,255,0.55));
    }
    .btn.danger{
      background: rgba(245,148,185,0.22);
      border-color: rgba(245,148,185,0.55);
    }

    .hidden{ display:none !important; }

    .bingo-banner{
      margin-top: 10px;
      border-radius: 14px;
      border: 3px solid rgba(169,230,162,0.8);
      background: rgba(223,241,234,0.85);
      padding: 10px 12px;
      display:none;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .bingo-banner.visible{ display:flex; }
    .bingo-banner .label{
      font-size:.75rem;
      letter-spacing:.14em;
      text-transform:uppercase;
      font-weight: 1000;
      color: rgba(43,43,43,0.65);
    }
    .bingo-banner .msg{
      font-weight: 900;
      color: rgba(43,43,43,0.82);
      margin-top: 2px;
    }

    .host-main{
      text-align:center;
      padding: 14px 12px;
      border-radius: 16px;
      border: 3px solid var(--mint);
      background: rgba(223,241,234,0.55);
    }
    .host-main-label{
      font-size:.8rem;
      text-transform:uppercase;
      letter-spacing:.14em;
      font-weight: 1000;
      color: rgba(43,43,43,0.65);
    }
    .host-main-call{
      margin-top: 8px;
      font-size: clamp(1.35rem, 2.6vw, 1.9rem);
      font-weight: 1000;
      color: rgba(43,43,43,0.9);
      line-height: 1.15;
      word-break: break-word;
    }

    .host-pattern{
      margin-top: 10px;
      border-radius: 16px;
      border: 3px solid var(--mint);
      background: #fbfffd;
      padding: 10px;
    }
    .host-pattern-title{
      font-size:.75rem;
      letter-spacing:.14em;
      text-transform:uppercase;
      font-weight: 1000;
      color: rgba(43,43,43,0.65);
      margin-bottom: 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .host-pattern-btns{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .host-pbtn{
      border:none;
      cursor:pointer;
      padding: 10px 12px;
      border-radius: 999px;
      border: 2px solid var(--mint);
      background: rgba(223,241,234,0.8);
      font-weight: 1000;
      color: rgba(43,43,43,0.82);
      flex: 1 1 auto;
      min-width: 120px;
    }
    .host-pbtn.active{
      background: linear-gradient(135deg, rgba(169,230,162,0.75), rgba(126,217,255,0.55));
    }

    .host-history{
      margin-top: 10px;
      border-radius: 16px;
      border: 3px solid var(--mint);
      background: #fbfffd;
      padding: 10px;
      max-height: 220px;
      overflow:auto;
    }
    .host-history-title{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      font-weight: 1000;
      color: rgba(43,43,43,0.7);
      font-size: .86rem;
      letter-spacing:.06em;
    }

    .host-history-list{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top: 10px;
    }

    .host-pill{
      border-radius: 999px;
      border: 2px solid rgba(151,200,184,0.9);
      background: rgba(223,241,234,0.75);
      padding: 7px 10px;
      font-weight: 1000;
      font-size: .86rem;
      color: rgba(43,43,43,0.82);
    }

    .confetti-overlay{
      position:fixed;
      inset:0;
      pointer-events:none;
      overflow:hidden;
      z-index: 50;
      display:none;
    }
    .confetti-overlay.active{ display:block; }
    .confetti-piece{
      position:absolute;
      width: 8px;
      height: 14px;
      border-radius: 2px;
      opacity:0;
      animation: confetti-fall 1.35s linear forwards;
    }
    @keyframes confetti-fall{
      0%{ transform: translate3d(0,-40px,0) rotateZ(0deg); opacity:1; }
      100%{ transform: translate3d(var(--x-move,0), 120vh, 0) rotateZ(340deg); opacity:0; }
    }

    .bingo-toast{
      position:fixed;
      left:50%;
      top: 12px;
      transform: translateX(-50%) translateY(-40px);
      background: rgba(255,255,255,0.9);
      border: 3px solid rgba(255,193,118,0.7);
      border-radius: 999px;
      padding: 10px 14px;
      box-shadow: var(--shadow);
      display:flex;
      gap:10px;
      align-items:center;
      opacity:0;
      pointer-events:none;
      transition: opacity .22s ease, transform .22s ease;
      z-index: 60;
    }
    .bingo-toast.visible{
      opacity:1;
      transform: translateX(-50%) translateY(0);
    }
    .bingo-toast .text{
      font-weight: 1000;
      letter-spacing:.10em;
      text-transform:uppercase;
      font-size: .78rem;
      color: rgba(43,43,43,0.85);
      white-space:nowrap;
    }

    .splash{
      position:fixed;
      inset:0;
      z-index: 70;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 18px;
      background: radial-gradient(circle at top, #f9e0ff 0, #e0f2fe 30%, #eefbf6 70%, #f8fffc 100%);
    }
    .splash-inner{
      width: min(520px, 100%);
      background: var(--paper);
      border: 3px solid var(--mint);
      border-radius: 24px;
      box-shadow: var(--shadow);
      padding: 18px 16px;
    }
    .splash-title{
      margin: 0 0 6px;
      font-weight: 1000;
      letter-spacing:.10em;
      text-transform: uppercase;
      color: rgba(43,43,43,0.9);
    }
    .splash-sub{
      margin: 0 0 12px;
      color: rgba(43,43,43,0.7);
      font-weight: 800;
    }
    .splash-list{
      margin: 0 0 14px;
      padding-left: 18px;
      color: rgba(43,43,43,0.78);
      font-weight: 800;
    }
    .splash-list li{ margin: 6px 0; }

    @media (max-width: 640px){
      body{ align-items:flex-end; }
    }

    footer{
      text-align:center;
      font-weight: 1000;
      color: rgba(43,43,43,0.65);
      margin-top: 4px;
    }
  </style>
</head>

<body>
  <div class="confetti-overlay" id="confettiOverlay"></div>

  <div class="bingo-toast" id="bingoToast">
    <span>üéâ</span>
    <span class="text" id="bingoToastText">Bingo! Announce it on Zoom</span>
  </div>

  <div class="splash" id="splashScreen">
    <div class="splash-inner">
      <div class="trim" style="margin-bottom:12px;"></div>
      <h1 class="splash-title">Baby Shower Bingo</h1>
      <p class="splash-sub">Players: keep this open while gifts are opened.</p>
      <ul class="splash-list">
        <li>When the host calls an item (word), tap it on your card to mark it.</li>
        <li>The host will tell everyone which pattern counts (Line / X / Corners / Blackout).</li>
        <li>Use the ‚ãØ menu to generate a fresh card (don‚Äôt do it mid-game).</li>
        <li>The center is a FREE space.</li>
      </ul>
      <button class="btn primary" id="startGameBtn" type="button">üéà Start</button>
    </div>
  </div>

  <div class="app">
    <div class="trim"></div>

    <header>
      <div class="titleBlock">
        <div class="titleInner">
          <div class="babyShower">Baby Shower</div>
          <div class="bingoWord">BINGO</div>
          <div class="subtitle">Tap words as the host calls them üéÅ</div>
        </div>
      </div>

      <div class="mode-switch" aria-label="Choose player or host view">
        <button class="mode-btn active" data-mode="player" id="playerModeBtn">üì± Player</button>
        <button class="mode-btn" data-mode="host" id="hostModeBtn">üéôÔ∏è Host</button>
      </div>
    </header>

    <main>
      <!-- PLAYER -->
      <section class="card-shell" id="playerPanel">
        <div class="section-header">
          <h2>My Bingo Card</h2>
          <span class="badge">Words ‚Ä¢ Gift-opening style</span>
        </div>

        <div class="bingo-grid" id="bingoGrid"></div>

        <div class="bingo-banner" id="bingoBanner">
          <div>
            <div class="label">Bingo detected</div>
            <div class="msg" id="bingoBannerMsg">You have a winning pattern. Tell the host.</div>
          </div>
          <span>üéâ</span>
        </div>

        <div class="bottom-toolbar">
          <div class="bottom-nav">
            <button class="card-switch-btn" id="prevCardBtn" type="button" aria-label="Previous card" title="Single card mode">‚óÄ</button>
            <div class="card-switch-label"><span id="cardLabel"><strong>Card 1</strong> of 1</span></div>
            <button class="card-switch-btn" id="nextCardBtn" type="button" aria-label="Next card" title="Single card mode">‚ñ∂</button>
          </div>

          <button class="menu-toggle-btn" id="playerMenuToggleBtn" type="button" aria-label="Card options">‚ãØ</button>
        </div>

        <div class="player-menu-backdrop hidden" id="playerMenuBackdrop"></div>

        <div class="player-menu hidden" id="playerMenu" role="dialog" aria-modal="true" aria-label="Card options">
          <div class="player-menu-head">
            <div class="player-menu-title">Card options</div>
            <button class="menu-close" id="menuCloseBtn" type="button" aria-label="Close card options">‚úï</button>
          </div>

          <button class="btn primary" id="nextCardMenuBtn" type="button">‚û°Ô∏è Next card (new card)</button>
          <button class="btn" id="clearMarksBtn" type="button">‚úñÔ∏è Clear marks</button>
          <button class="btn danger" id="resetAllBtn" type="button">üßπ Reset everything</button>
        </div>
      </section>

      <!-- HOST -->
      <section class="card-shell hidden" id="hostPanel">
        <div class="section-header">
          <h2>Host Caller Tools</h2>
          <span class="badge" id="poolCountBadge">0 items</span>
        </div>

        <div class="host-main">
          <div class="host-main-label">Current item to call</div>
          <div class="host-main-call" id="currentCallDisplay">‚Äî</div>
        </div>

        <div class="host-pattern">
          <div class="host-pattern-title">
            <span>Game pattern (tell players):</span>
            <span class="badge" id="hostPatternBadge">Line</span>
          </div>
          <div class="host-pattern-btns">
            <button class="host-pbtn active" data-pattern="line" type="button">Line</button>
            <button class="host-pbtn" data-pattern="x" type="button">X</button>
            <button class="host-pbtn" data-pattern="corners" type="button">4 Corners</button>
            <button class="host-pbtn" data-pattern="full" type="button">Blackout</button>
          </div>
        </div>

        <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
          <button class="btn primary" id="nextWordBtn" type="button">üé≤ Draw next item</button>
          <button class="btn" id="resetCallerBtn" type="button">üîÅ Reset caller</button>
        </div>

        <div class="host-history">
          <div class="host-history-title">
            <span>Items already called</span>
            <span id="calledCountLabel">0 / 0</span>
          </div>
          <div class="host-history-list" id="calledWordsList"></div>
        </div>
      </section>
    </main>

    <footer>Thank you for playing! üß∏</footer>
  </div>

  <script>
    (function(){
      const WORD_POOL = [
        "diapers","wipes","onesie","bib","burp cloth","pacifier","bottle","bottle brush","bottle warmer","bottle holder",
        "formula","breast pump","nursing pad","milk","rattle","teether","teething rings","blanket","receiving blanket","swaddle",
        "swaddle wrap","mittens","booties","hat","socks","pajamas","romper","baby lotion","baby wash","baby shampoo",
        "thermometer","baby oil","diaper cream","changing pad","changing table","diaper bag","diaper pail","diaper pin","washcloths",
        "hooded towel","crib","crib sheet","bassinet","playard","stroller","car seat","baby carrier","baby sling",
        "rocking chair","baby swing","bouncer","high chair","baby monitor","night light","humidifier","sound machine","teddy bear","plush toy",
        "stuffed animal","board book","storybook","baby bath","bath tub","grooming kit","hair brush","baby comb",
        "play mat","toy set","stacking cups","soft blocks","tummy time","baby mobile","stork","piggy bank","gift card",
        "spoons","sippy cup","cup","bowl","plates","snack cup","feeding bibs","baby food","walker","baby shoes",
        "jumper","pacifier clip","laundry detergent","baby hangers","drawer dividers","travel crib","stroller fan","car mirror","sun shade"
      ];

      const COLORS = ["c1","c2","c3","c4","c5"];

      const bingoGrid = document.getElementById("bingoGrid");
      const clearMarksBtn = document.getElementById("clearMarksBtn");
      const resetAllBtn = document.getElementById("resetAllBtn");

      const bingoBanner = document.getElementById("bingoBanner");
      const bingoBannerMsg = document.getElementById("bingoBannerMsg");

      const confettiOverlay = document.getElementById("confettiOverlay");
      const bingoToast = document.getElementById("bingoToast");
      const bingoToastText = document.getElementById("bingoToastText");

      const playerModeBtn = document.getElementById("playerModeBtn");
      const hostModeBtn = document.getElementById("hostModeBtn");
      const playerPanel = document.getElementById("playerPanel");
      const hostPanel = document.getElementById("hostPanel");

      const nextWordBtn = document.getElementById("nextWordBtn");
      const resetCallerBtn = document.getElementById("resetCallerBtn");
      const currentCallDisplay = document.getElementById("currentCallDisplay");
      const calledWordsList = document.getElementById("calledWordsList");
      const calledCountLabel = document.getElementById("calledCountLabel");
      const poolCountBadge = document.getElementById("poolCountBadge");

      const prevCardBtn = document.getElementById("prevCardBtn");
      const nextCardBtn = document.getElementById("nextCardBtn");
      const cardLabel = document.getElementById("cardLabel");

      const splashScreen = document.getElementById("splashScreen");
      const startGameBtn = document.getElementById("startGameBtn");

      const playerMenu = document.getElementById("playerMenu");
      const playerMenuBackdrop = document.getElementById("playerMenuBackdrop");
      const playerMenuToggleBtn = document.getElementById("playerMenuToggleBtn");
      const menuCloseBtn = document.getElementById("menuCloseBtn");
      const nextCardMenuBtn = document.getElementById("nextCardMenuBtn");

      const hostPatternBadge = document.getElementById("hostPatternBadge");
      const hostPatternButtons = Array.from(document.querySelectorAll(".host-pbtn"));

      let card = null;
      let lastCardSignature = "";

      let callerPool = [];
      let callerHistory = [];

      function shuffle(array){
        const copy = array.slice();
        for(let i = copy.length - 1; i > 0; i--){
          const j = Math.floor(Math.random() * (i + 1));
          [copy[i], copy[j]] = [copy[j], copy[i]];
        }
        return copy;
      }

      function pickNUniqueWords(n){
        const pool = shuffle(WORD_POOL);
        return pool.slice(0, n);
      }

      function createCardData(){
        const words = pickNUniqueWords(24);
        const grid = Array.from({length:5}, () => Array.from({length:5}, () => ""));
        const marked = Array.from({length:5}, () => Array.from({length:5}, () => false));
        let idx = 0;

        for(let r=0; r<5; r++){
          for(let c=0; c<5; c++){
            if(r===2 && c===2) continue;
            grid[r][c] = words[idx++];
          }
        }

        grid[2][2] = "FREE";
        marked[2][2] = true;

        return { grid, marked, bingoShown:false };
      }

      function signatureForCard(c){
        // Stable signature for "did this actually change?"
        // (Ignore center)
        const flat = [];
        for(let r=0;r<5;r++){
          for(let c2=0;c2<5;c2++){
            if(r===2 && c2===2) continue;
            flat.push(String(c.grid[r][c2]).toLowerCase());
          }
        }
        return flat.join("|");
      }

      function pawSvg(){
        return `
          <svg class="pawAmp" viewBox="0 0 64 64" aria-hidden="true">
            <path fill="rgba(43,43,43,0.78)" d="M20.5 27.5c-3.3 0-6-3.4-6-7.5S17.2 12.5 20.5 12.5s6 3.4 6 7.5-2.7 7.5-6 7.5zm23 0c-3.3 0-6-3.4-6-7.5s2.7-7.5 6-7.5 6 3.4 6 7.5-2.7 7.5-6 7.5zM12.8 36.4c-3 0-5.5-2.9-5.5-6.4s2.4-6.4 5.5-6.4 5.5 2.9 5.5 6.4-2.4 6.4-5.5 6.4zm38.4 0c-3 0-5.5-2.9-5.5-6.4s2.4-6.4 5.5-6.4 5.5 2.9 5.5 6.4-2.4 6.4-5.5 6.4z"/>
            <path fill="rgba(43,43,43,0.78)" d="M32 56c-10.7 0-18.8-6.7-18.8-14.6 0-6.8 5.9-12.5 14.1-13.9 1.7-.3 3.5.5 4.7 1.9 1.2-1.4 3-2.2 4.7-1.9 8.2 1.4 14.1 7.1 14.1 13.9C50.8 49.3 42.7 56 32 56z"/>
          </svg>
        `;
      }

      function maybeVibrate(){
        if(window.navigator && "vibrate" in window.navigator){
          try{ window.navigator.vibrate(15); }catch(e){}
        }
      }

      function renderCard(){
        bingoGrid.innerHTML = "";
        if(!card) return;

        let colorIdx = 0;

        for(let r=0; r<5; r++){
          for(let c=0; c<5; c++){
            const btn = document.createElement("button");
            btn.type = "button";
            btn.className = "bingo-cell";
            btn.dataset.free = (r===2 && c===2) ? "true" : "false";
            if(btn.dataset.free === "true") btn.classList.add("free");

            const span = document.createElement("div");
            span.className = "value";

            if(btn.dataset.free === "true"){
              span.innerHTML = `
                <div class="freeMark">
                  <div class="freeDG">
                    <span>D</span>
                    ${pawSvg()}
                    <span>G</span>
                  </div>
                  <div class="freeSmall">FREE SPACE</div>
                </div>
              `;
            }else{
              const colorClass = COLORS[colorIdx % COLORS.length];
              colorIdx++;
              span.classList.add(colorClass);
              span.textContent = card.grid[r][c];
            }

            btn.appendChild(span);

            if(card.marked[r][c]) btn.classList.add("marked");
            btn.addEventListener("click", () => handleCellClick(r,c,btn));

            bingoGrid.appendChild(btn);
          }
        }

        cardLabel.innerHTML = "<strong>Card 1</strong> of 1";
      }

      function handleCellClick(r,c,el){
        if(el.dataset.free === "true") return;

        card.marked[r][c] = !card.marked[r][c];
        el.classList.toggle("marked", card.marked[r][c]);

        el.classList.remove("pulse");
        void el.offsetWidth;
        el.classList.add("pulse");

        maybeVibrate();
        checkForBingoAnyPattern();
      }

      function hasLine(marked){
        const size = 5;
        for(let r=0;r<size;r++){
          if(marked[r].every(Boolean)) return true;
        }
        for(let c=0;c<size;c++){
          let ok = true;
          for(let r=0;r<size;r++){
            if(!marked[r][c]){ ok=false; break; }
          }
          if(ok) return true;
        }
        let d1=true, d2=true;
        for(let i=0;i<size;i++){
          if(!marked[i][i]) d1=false;
          if(!marked[i][size-1-i]) d2=false;
        }
        return d1 || d2;
      }
      function hasX(marked){
        let d1=true, d2=true;
        for(let i=0;i<5;i++){
          if(!marked[i][i]) d1=false;
          if(!marked[i][4-i]) d2=false;
        }
        return d1 && d2;
      }
      function hasCorners(marked){
        return marked[0][0] && marked[0][4] && marked[4][0] && marked[4][4];
      }
      function hasFull(marked){
        for(let r=0;r<5;r++){
          for(let c=0;c<5;c++){
            if(!marked[r][c]) return false;
          }
        }
        return true;
      }

      function checkForBingoAnyPattern(){
        if(card.bingoShown) return;

        const wins = [];
        if(hasLine(card.marked)) wins.push("Line");
        if(hasX(card.marked)) wins.push("X");
        if(hasCorners(card.marked)) wins.push("4 Corners");
        if(hasFull(card.marked)) wins.push("Blackout");

        if(wins.length){
          card.bingoShown = true;
          const msg = wins.length === 1
            ? `You have a ${wins[0]} bingo. Tell the host.`
            : `You match these patterns: ${wins.join(", ")}. Tell the host which one counts.`;

          bingoBannerMsg.textContent = msg;
          bingoBanner.classList.add("visible");

          bingoToastText.textContent = "Bingo! Announce it on Zoom üéôÔ∏è";
          triggerConfetti();
          showToast();
        }
      }

      function triggerConfetti(){
        confettiOverlay.innerHTML = "";
        confettiOverlay.classList.add("active");
        const colors = ["#7ed9ff","#f594b9","#a78bd0","#a9e6a2","#ffc176","#97c8b8"];

        const COUNT = 80;
        for(let i=0;i<COUNT;i++){
          const p = document.createElement("div");
          p.className = "confetti-piece";
          p.style.backgroundColor = colors[i % colors.length];
          p.style.left = (Math.random()*100) + "%";
          p.style.animationDelay = (Math.random()*0.6).toFixed(2) + "s";
          p.style.setProperty("--x-move", ((Math.random()*160)-80).toFixed(1) + "px");
          confettiOverlay.appendChild(p);
        }

        setTimeout(() => {
          confettiOverlay.classList.remove("active");
          confettiOverlay.innerHTML = "";
        }, 1700);
      }

      let toastTimeout;
      function showToast(){
        clearTimeout(toastTimeout);
        bingoToast.classList.add("visible");
        toastTimeout = setTimeout(() => bingoToast.classList.remove("visible"), 4200);
      }

      function clearMarks(){
        for(let r=0;r<5;r++){
          for(let c=0;c<5;c++){
            card.marked[r][c] = false;
          }
        }
        card.marked[2][2] = true;
        card.bingoShown = false;
        bingoBanner.classList.remove("visible");
        bingoToast.classList.remove("visible");
        renderCard();
      }

      function replaceCardWithNew(){
        // Ensure "new card" is truly new (not identical)
        let attempts = 0;
        let next;
        let sig;
        do{
          next = createCardData();
          sig = signatureForCard(next);
          attempts++;
        }while(sig === lastCardSignature && attempts < 12);

        card = next;
        lastCardSignature = sig;

        bingoBanner.classList.remove("visible");
        bingoToast.classList.remove("visible");
        renderCard();
      }

      function resetAll(){
        if(!confirm("Reset everything on this device and start fresh?")) return;
        replaceCardWithNew();
        closePlayerMenu();
        initCaller();
      }

      function setMode(mode){
        const isPlayer = mode === "player";
        playerModeBtn.classList.toggle("active", isPlayer);
        hostModeBtn.classList.toggle("active", !isPlayer);
        playerPanel.classList.toggle("hidden", !isPlayer);
        hostPanel.classList.toggle("hidden", isPlayer);
      }

      function openPlayerMenu(){
        playerMenu.classList.remove("hidden");
        playerMenuBackdrop.classList.remove("hidden");
      }
      function closePlayerMenu(){
        playerMenu.classList.add("hidden");
        playerMenuBackdrop.classList.add("hidden");
      }

      function initCaller(){
        callerPool = shuffle(WORD_POOL);
        callerHistory = [];
        currentCallDisplay.textContent = "‚Äî";
        updateCalledList();
        poolCountBadge.textContent = WORD_POOL.length + " items";
      }

      function drawNextWord(){
        if(!callerPool.length){
          alert("All items have been called.");
          return;
        }
        const word = callerPool.shift();
        callerHistory.unshift(word);
        currentCallDisplay.textContent = word;
        updateCalledList();
      }

      function updateCalledList(){
        calledWordsList.innerHTML = "";
        callerHistory.forEach(w => {
          const pill = document.createElement("div");
          pill.className = "host-pill";
          pill.textContent = w;
          calledWordsList.appendChild(pill);
        });
        calledCountLabel.textContent = callerHistory.length + " / " + WORD_POOL.length;
      }

      function setHostPattern(patternKey){
        const map = { line:"Line", x:"X", corners:"4 Corners", full:"Blackout" };
        hostPatternBadge.textContent = map[patternKey] || "Line";
        hostPatternButtons.forEach(b => b.classList.toggle("active", b.dataset.pattern === patternKey));
      }

      // Events
      startGameBtn.addEventListener("click", () => splashScreen.classList.add("hidden"));

      playerModeBtn.addEventListener("click", () => setMode("player"));
      hostModeBtn.addEventListener("click", () => setMode("host"));

      clearMarksBtn.addEventListener("click", clearMarks);
      resetAllBtn.addEventListener("click", resetAll);

      // Menu open/close
      playerMenuToggleBtn.addEventListener("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        const isHidden = playerMenu.classList.contains("hidden");
        isHidden ? openPlayerMenu() : closePlayerMenu();
      });

      menuCloseBtn.addEventListener("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        closePlayerMenu();
      });

      playerMenuBackdrop.addEventListener("click", closePlayerMenu);

      // IMPORTANT FIX: Next card generates NEW card + closes menu
      nextCardMenuBtn.addEventListener("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        replaceCardWithNew();
        closePlayerMenu();
      });

      // Arrows present but disabled visually; kept for layout consistency
      prevCardBtn.addEventListener("click", () => {});
      nextCardBtn.addEventListener("click", () => {});

      // Host caller
      nextWordBtn.addEventListener("click", drawNextWord);
      resetCallerBtn.addEventListener("click", () => {
        if(confirm("Reset the caller and clear all called items?")) initCaller();
      });

      hostPatternButtons.forEach(btn => {
        btn.addEventListener("click", () => setHostPattern(btn.dataset.pattern));
      });

      // Init
      replaceCardWithNew();          // sets card + signature + renders
      setMode("player");
      initCaller();
      setHostPattern("line");
    })();
  </script>
</body>
</html>
